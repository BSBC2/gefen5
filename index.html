<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>גפ"ן AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --color-bg: #f4f7f6;
      --color-container-bg: rgba(255,255,255,0.95);
      --color-header-bg: #8bc53f;
      --color-header-text: #ffffff;
      --color-border: #7cb342;
      --color-user-msg: #e8f5e9;
      --color-bot-msg: #ffffff;
      --color-text: #333333;
      --color-input-bg: #ffffff;
      --color-input-border: #dddddd;
      --color-button-bg: #8bc53f;
      --color-button-hover: #6fae30;
    }

    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:'Assistant',sans-serif;
      background:var(--color-bg);
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      color:var(--color-text);
    }
    .chat-container{
      width:100%;max-width:400px;
      background:var(--color-container-bg);
      border:2px solid var(--color-border);
      border-radius:16px;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      display:flex;flex-direction:column;overflow:hidden;
    }
    .chat-header{
      background:var(--color-header-bg);
      padding:16px;
      text-align:center;
      color:var(--color-header-text);
      font-size:1.2rem;font-weight:700;
    }
    .chat-body{
      flex:1;padding:12px;background:var(--color-bg);
      overflow-y:auto;display:flex;flex-direction:column;gap:8px;
    }
    .message{
      max-width:80%;padding:12px 16px;border-radius:20px;
      word-wrap:break-word;box-shadow:0 2px 6px rgba(0,0,0,0.08);
    }
    .message.user{background:var(--color-user-msg);align-self:flex-end;}
    .message.bot{background:var(--color-bot-msg);align-self:flex-start;}
    .typing{display:inline-block;width:10px;height:10px;margin-left:4px;border-radius:50%;background:var(--color-header-bg);animation:blink 1s infinite alternate;}
    @keyframes blink{from{opacity:1}to{opacity:.3}}
    .chat-input{display:flex;border-top:1px solid var(--color-input-border);background:var(--color-input-bg);padding:8px 12px;}
    .chat-input textarea{flex:1;border:none;padding:10px;resize:none;font-size:1rem;outline:none;background:var(--color-input-bg);color:var(--color-text);border-radius:8px;border:1px solid var(--color-input-border);font-family:inherit;}
    .chat-input button{background:var(--color-button-bg);border:none;color:#fff;padding:0 16px;margin-inline-start:8px;font-size:1rem;cursor:pointer;transition:background .2s;border-radius:8px;font-family:inherit;}
    .chat-input button:hover{background:var(--color-button-hover);}
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">גפ"ן AI</div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input">
      <textarea id="userInput" rows="1" placeholder="הקלד הודעה..."></textarea>
      <button id="sendBtn">שלח</button>
    </div>
  </div>

  <script>
    function getSessionId(){let sid=localStorage.getItem('dnaidea_sessionId');if(!sid){sid=crypto.randomUUID();localStorage.setItem('dnaidea_sessionId',sid);}return sid;}
    const sessionId=getSessionId();
    const chatBody=document.getElementById('chatBody');
    const userInput=document.getElementById('userInput');
    const sendBtn=document.getElementById('sendBtn');

    function appendMessage(text,className){const msg=document.createElement('div');msg.className='message '+className;msg.textContent=text;chatBody.appendChild(msg);chatBody.scrollTop=chatBody.scrollHeight;}

    async function sendMessage(){const text=userInput.value.trim();if(!text)return;appendMessage(text,'user');userInput.value='';const typing=document.createElement('div');typing.className='message bot';typing.innerHTML='<span class="typing"></span>'.repeat(3);chatBody.appendChild(typing);chatBody.scrollTop=chatBody.scrollHeight;try{const res=await fetch('https://shacharb8.app.n8n.cloud/webhook/Gefenbot1111',{method:'POST',mode:'cors',headers:{'Content-Type':'application/json'},body:JSON.stringify({sessionId,prompt:text})});const data=await res.json();chatBody.removeChild(typing);const payload=Array.isArray(data)?data[0]:data;const botText=payload.output||payload.reply||payload.message||JSON.stringify(payload);appendMessage(botText,'bot');}catch(err){chatBody.removeChild(typing);appendMessage('שגיאה בשליחה: '+err.message,'bot');}}

    sendBtn.addEventListener('click',sendMessage);
    userInput.addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}});
  </script>
</body>
</html>
